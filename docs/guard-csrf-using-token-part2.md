# トークンを使って防ぐ part 2
この節では、前章で説明した csrf token を用いた防御方法の変化形と、その危険性を説明します。

# cookie の二重送信
この防御手法は、攻撃者が cookie を盗聴することができない、という前提を用いたものです。
従来の csrf token を用いた防御手法は、サーバー側のアプリケーションと、クライアント側のフォームにランダムな文字列を埋め込み、フォーム送信時に両者を比較することで検証を行っていました。
これは、以下の前提から成り立っています。
- トークンが改ざんされていないか検証するために2つ以上の情報源が必要
- トークンの情報源のうち、少なくとも一つは攻撃者が偽造、改ざんできない
- トークンを攻撃者は盗み見ることができない

たとえば、クライアント側にトークンを送信するだけで、サーバー側に保存しないと、クライアントから送信されたトークンが本物かどうかを確かめることができません。
あるいは、トークンの情報を二つとも攻撃者が捏造できると、攻撃者が偽造したトークンと攻撃者が偽造したトークンを検証するようなことになってしまいます。
また、トークンを攻撃者が盗み見ることができると、攻撃者は正規のリクエストであるかのように偽装できてしまいます。

一方で、csrf token をサーバー側にも保存しなければいけないことで、HTTP のステートレス性が壊されてしまいます。（ログイン認証でもやってるじゃん、ということは見ないふりをします）
まあ、フォームを検証するためだけに DB の機能を追加するのは少しイヤです。

そこで、クライアント側に二つの情報源を保存しつつ、そのうち一つは攻撃者が偽造、改ざんできないことを保証しつつ、盗聴できないようにしつつ、クライアント側にすべてを保存する方法が提案されました。
